!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("JDate",[],t):"object"==typeof exports?exports.JDate=t():e.JDate=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports={MONTH_NAMES:["فروردین","اردیبهشت","خرداد","تیر","امرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],ABBR_DAYS:["۱ش","۲ش","۳ش","۴ش","۵ش","ج","ش"],DAYS_NAMES:["یکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه","شنبه"],GREGORIAN_EPOCH:1721425.5,PERSIAN_EPOCH:1948320.5}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return h}));var n=r(0);function a(e,t){return e-Math.floor(e/t)*t}function o(e){return e&&1===e.length?"0".concat(e):e}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,o=[{key:"leapGregorian",value:function(e){return e%4==0&&!(e%100==0&&e%400!=0)}},{key:"gregorianToJulian",value:function(t,r,a){var o;return o=r<=2?0:e.leapGregorian(t)?-1:-2,n.GREGORIAN_EPOCH-1+365*(t-1)+Math.floor((t-1)/4)+-Math.floor((t-1)/100)+Math.floor((t-1)/400)+Math.floor((367*r-362)/12+(o+a))}},{key:"julianToGregorian",value:function(t){var r=Math.floor(t-.5)+.5,o=r-n.GREGORIAN_EPOCH,i=Math.floor(o/146097),u=a(o,146097),l=Math.floor(u/36524),f=a(u,36524),c=Math.floor(f/1461),s=a(f,1461),h=Math.floor(s/365),p=400*i+100*l+4*c+h;4!==l&&4!==h&&(p+=1);var y,v=r-e.gregorianToJulian(p,1,1);y=r<e.gregorianToJulian(p,3,1)?0:(e.leapGregorian(p),1);var g=Math.floor((12*(v+y)+373)/367);return[p,g,r-e.gregorianToJulian(p,g,1)+1]}},{key:"leapPersian",value:function(e){return 1403===e||682*((e-(e>0?474:473))%2820+474+38)%2816<682}},{key:"persianToJulian",value:function(e,t,r){var o=e-(e>=0?474:473),i=474+a(o,2820);return r+(t<=7?31*(t-1):30*(t-1)+6)+Math.floor((682*i-110)/2816)+365*(i-1)+1029983*Math.floor(o/2820)+(n.PERSIAN_EPOCH-1)}},{key:"julianToPersian",value:function(t){var r,n=Math.floor(t)+.5,o=n-e.persianToJulian(475,1,1),i=Math.floor(o/1029983),u=a(o,1029983);if(1029982===u)r=2820;else{var l=Math.floor(u/366),f=a(u,366);r=Math.floor((2134*l+2816*f+2815)/1028522)+l+1}var c=r+2820*i+474;c<=0&&(c-=1);var s=n-e.persianToJulian(c,1,1)+1,h=s<=186?Math.ceil(s/31):Math.ceil((s-6)/30);return[c,h,n-e.persianToJulian(c,h,1)+1]}},{key:"persianToGregorian",value:function(t,r,n){var a=e.persianToJulian(t,r,n);return e.julianToGregorian(a)}},{key:"gregorianToPersian",value:function(t,r,n){var a=e.gregorianToJulian(t,r,n);return e.julianToPersian(a)}}],(r=null)&&i(t.prototype,r),o&&i(t,o),e}();function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(){c(this,e);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(Array.isArray(r[0])||r[0]instanceof Date)this.input=r[0];else if(3===r.length)this.input=r;else{if(r.length)throw new Error("Unexpected input");this.input=new Date}Array.isArray(this.input)?(this.date=this.input.map((function(e){return parseInt(e,10)})),this._d=this.toGregorian()):this.input instanceof Date&&(this._d=this.input,this.date=e.toJalali(this.input))}var t,r,a;return t=e,a=[{key:"toJalali",value:function(e){var t=u.gregorianToJulian(e.getFullYear(),e.getMonth()+1,e.getDate());return u.julianToPersian(t)}},{key:"to_jalali",value:function(t){return e.toJalali(t)}},{key:"toGregorian",value:function(e,t,r){var n=u.julianToGregorian(u.persianToJulian(e,t,r));return new Date(+n[0],+n[1]-1,+n[2])}},{key:"to_gregorian",value:function(t,r,n){return e.toGregorian(t,r,n)}},{key:"isLeapYear",value:function(e){return u.leapPersian(e)}},{key:"daysInMonth",value:function(t,r){var n=t-Math.floor(r/12),a=r-12*Math.floor(r/12);return a<0?(a+=12,n-=1):0===a&&(a=12),a<6?31:a<11||e.isLeapYear(n)?30:29}}],(r=[{key:"toGregorian",value:function(){return e.toGregorian(this.date[0],this.date[1],this.date[2])}},{key:"getFullYear",value:function(){return this.date[0]}},{key:"setFullYear",value:function(e){return this.date[0]=parseInt(e,10),this.input=this.toGregorian(),this}},{key:"getMonth",value:function(){return this.date[1]}},{key:"setMonth",value:function(e){var t=l(function(e,t){if(t>12||t<=0){var r=Math.floor((t-1)/12);return[e-r,t-12*r]}return[e,t]}(this.getFullYear(),parseInt(e,10)),2);return this.date[0]=t[0],this.date[1]=t[1],this.input=this.toGregorian(),this}},{key:"getDate",value:function(){return this.date[2]}},{key:"setDate",value:function(e){return this.date[2]=parseInt(e,10),this.input=this.toGregorian(),this}},{key:"getDay",value:function(){return this._d.getDay()}},{key:"format",value:function(e){var t=function e(t,r){var n=t.match(/[yY]+/);if(!n)return t;switch(n[0]){case"YYYY":case"YYY":return e(t.replace(n,r.getFullYear()),r);case"YY":return e(t.replace(n,String(r.getFullYear()).slice(2)),r);default:return t}}(e,this);return t=function e(t,r){var a=t.match(/[dD]+/);if(!a)return t;switch(a[0]){case"D":return e(t.replace(a,r.getDate()),r);case"DD":var i=o(r.getDate().toString());return e(t.replace(a,i),r);case"d":case"dd":return e(t.replace(a,n.ABBR_DAYS[r.getDay()]),r);case"ddd":case"dddd":return e(t.replace(a,n.DAYS_NAMES[r.getDay()]),r);default:return t}}(t=function e(t,r){var a=t.match(/[mM]+/);if(!a)return t;switch(a[0]){case"M":return e(t.replace(a,r.getMonth()),r);case"MM":var i=o(r.getMonth().toString());return e(t.replace(a,i),r);case"MMM":case"MMMM":return e(t.replace(a,n.MONTH_NAMES[r.getMonth()-1]),r);default:return t}}(t,this),this)}}])&&s(t.prototype,r),a&&s(t,a),e}()}]).default}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9KRGF0ZS93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vSkRhdGUvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vSkRhdGUvLi9zcmMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL0pEYXRlLy4vc3JjL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vSkRhdGUvLi9zcmMvY29udmVydGVyLmpzIiwid2VicGFjazovL0pEYXRlLy4vc3JjL2pkYXRlLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiTU9OVEhfTkFNRVMiLCJBQkJSX0RBWVMiLCJEQVlTX05BTUVTIiwiR1JFR09SSUFOX0VQT0NIIiwiUEVSU0lBTl9FUE9DSCIsIm1vZCIsImEiLCJiIiwiTWF0aCIsImZsb29yIiwiemVyb0xlYWRpbmciLCJzdHIiLCJsZW5ndGgiLCJDb252ZXJ0ZXIiLCJ5ZWFyIiwibW9udGgiLCJkYXkiLCJwYWQiLCJsZWFwR3JlZ29yaWFuIiwiamQiLCJ3amQiLCJkZXBvY2giLCJxdWFkcmljZW50IiwiZHFjIiwiY2VudCIsImRjZW50IiwicXVhZCIsImRxdWFkIiwieWluZGV4IiwibGVhcGFkaiIsInllYXJkYXkiLCJncmVnb3JpYW5Ub0p1bGlhbiIsImVwYmFzZSIsImVweWVhciIsInljeWNsZSIsIm5qZCIsInBlcnNpYW5Ub0p1bGlhbiIsImN5Y2xlIiwiY3llYXIiLCJhdXgxIiwiYXV4MiIsInlkYXkiLCJjZWlsIiwianVsaWFuIiwianVsaWFuVG9HcmVnb3JpYW4iLCJqdWxpYW5Ub1BlcnNpYW4iLCJKRGF0ZSIsImFyZ3MiLCJBcnJheSIsImlzQXJyYXkiLCJEYXRlIiwiaW5wdXQiLCJFcnJvciIsImRhdGUiLCJtYXAiLCJudW0iLCJwYXJzZUludCIsIl9kIiwidG9HcmVnb3JpYW4iLCJ0b0phbGFsaSIsImp1bGlhbkRhdGUiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImdkYXRlIiwibGVhcFBlcnNpYW4iLCJjYWxjZWRZZWFyIiwiY2FsY2VkTW9udGgiLCJpc0xlYXBZZWFyIiwieWVhckRpZmYiLCJoZWxwZXJzIiwiZ2V0RGF5IiwiZm9ybWF0IiwicmVzdWx0IiwicmVwbGFjZVllYXIiLCJtYXRjaCIsInJlcGxhY2UiLCJTdHJpbmciLCJzbGljZSIsInJlcGxhY2VEYXkiLCJ6ZXJvTGVhZGluZ0RhdGUiLCJ0b1N0cmluZyIsInJlcGxhY2VNb250aCIsInplcm9MZWFkaW5nTW9udGgiXSwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFBWkMsU0FBMEMsaUJBQVhDLE9BQ3hDQSxPQUFPRCxRQUFVRCxJQUNRLG1CQUFYRyxRQUF5QkEsT0FBT0MsSUFDOUNELE9BQU8sUUFBUyxHQUFJSCxHQUNNLGlCQUFaQyxRQUNkQSxRQUFlLE1BQUlELElBRW5CRCxFQUFZLE1BQUlDLElBUmxCLENBU0dLLE1BQU0sV0FDVCxPLFlDVEUsSUFBSUMsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVVAsUUFHbkMsSUFBSUMsRUFBU0ksRUFBaUJFLEdBQVksQ0FDekNDLEVBQUdELEVBQ0hFLEdBQUcsRUFD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WTJDLEVBQUtTLFdBQVdtQixZQUVyRCxPQURjQyxFQUFhdkUsRUFBSWlFLFFBQVFELEVBQU9RLEdBQW1COUIsR0FHbkUsSUFBSyxNQUNMLElBQUssT0FJSCxPQUhjNkIsRUFDWnZFLEVBQUlpRSxRQUFRRCxFQUFPM0UsY0FBWXFELEVBQUtTLFdBQWEsSUFBS1QsR0FJMUQsUUFDRSxPQUFPMUMsR0V5SEEyRCxDQUFxQkcsRUFBUTdHLE1BQ0ZBLFciLCJmaWxlIjoiamRhdGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoXCJKRGF0ZVwiLCBbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJKRGF0ZVwiXSA9IGZhY3RvcnkoKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJKRGF0ZVwiXSA9IGZhY3RvcnkoKTtcbn0pKHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsIm1vZHVsZS5leHBvcnRzID0ge1xuICBNT05USF9OQU1FUzogWyfZgdix2YjYsdiv24zZhicsICfYp9ix2K/bjNio2YfYtNiqJywgJ9iu2LHYr9in2K8nLCAn2KrbjNixJywgJ9in2YXYsdiv2KfYrycsICfYtNmH2LHbjNmI2LEnLCAn2YXZh9ixJywgJ9ii2KjYp9mGJywgJ9ii2LDYsScsICfYr9uMJywgJ9io2YfZhdmGJywgJ9in2LPZgdmG2K8nXSxcbiAgQUJCUl9EQVlTOiBbJ9ux2LQnLCAn27LYtCcsICfbs9i0JywgJ9u02LQnLCAn27XYtCcsICfYrCcsICfYtCddLFxuICBEQVlTX05BTUVTOiBbJ9uM2qnYtNmG2KjZhycsICfYr9mI2LTZhtio2YcnLCAn2LPZh+KAjNi02YbYqNmHJywgJ9qG2YfYp9ix2LTZhtio2YcnLCAn2b7Zhtis4oCM2LTZhtio2YcnLCAn2KzZhdi52YcnLCAn2LTZhtio2YcnXSxcbiAgR1JFR09SSUFOX0VQT0NIOiAxNzIxNDI1LjUsXG4gIFBFUlNJQU5fRVBPQ0g6IDE5NDgzMjAuNVxufTtcbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG5cbmltcG9ydCB7XG4gIE1PTlRIX05BTUVTLFxuICBBQkJSX0RBWVMsXG4gIERBWVNfTkFNRVNcbn0gZnJvbSAnLi9jb25zdGFudHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZGl2KGEsIGIpIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoYSAvIGIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbW9kKGEsIGIpIHtcbiAgcmV0dXJuIGEgLSAoTWF0aC5mbG9vcihhIC8gYikgKiBiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpeE1vbnRoKHllYXIsIG1vbnRoKSB7XG4gIGlmIChtb250aCA+IDEyIHx8IG1vbnRoIDw9IDApIHtcbiAgICBjb25zdCB5ZWFyRGlmZiA9IE1hdGguZmxvb3IoKG1vbnRoIC0gMSkgLyAxMik7XG4gICAgY29uc3QgbmV3WWVhciA9IHllYXIgLSB5ZWFyRGlmZjtcbiAgICBjb25zdCBuZXdNb250aCA9IG1vbnRoIC0gKHllYXJEaWZmICogMTIpO1xuXG4gICAgcmV0dXJuIFtuZXdZZWFyLCBuZXdNb250aF07XG4gIH1cblxuICByZXR1cm4gW3llYXIsIG1vbnRoXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHplcm9MZWFkaW5nKHN0cikge1xuICBpZiAoc3RyICYmIHN0ci5sZW5ndGggPT09IDEpIHsgcmV0dXJuIGAwJHtzdHJ9YDsgfVxuICByZXR1cm4gc3RyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZVllYXIoc3RyLCBkYXRlKSB7XG4gIGNvbnN0IG1hdGNoID0gc3RyLm1hdGNoKC9beVldKy8pO1xuICBpZiAoIW1hdGNoKSB7IHJldHVybiBzdHI7IH1cbiAgc3dpdGNoIChtYXRjaFswXSkge1xuICAgIGNhc2UgJ1lZWVknOlxuICAgIGNhc2UgJ1lZWSc6IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcmVwbGFjZVllYXIoc3RyLnJlcGxhY2UobWF0Y2gsIGRhdGUuZ2V0RnVsbFllYXIoKSksIGRhdGUpO1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBjYXNlICdZWSc6IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcmVwbGFjZVllYXIoXG4gICAgICAgIHN0ci5yZXBsYWNlKG1hdGNoLCBTdHJpbmcoZGF0ZS5nZXRGdWxsWWVhcigpKS5zbGljZSgyKSksIGRhdGVcbiAgICAgICk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlTW9udGgoc3RyLCBkYXRlKSB7XG4gIGNvbnN0IG1hdGNoID0gc3RyLm1hdGNoKC9bbU1dKy8pO1xuICBpZiAoIW1hdGNoKSB7IHJldHVybiBzdHI7IH1cbiAgc3dpdGNoIChtYXRjaFswXSkge1xuICAgIGNhc2UgJ00nOiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHJlcGxhY2VNb250aChzdHIucmVwbGFjZShtYXRjaCwgZGF0ZS5nZXRNb250aCgpKSwgZGF0ZSk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGNhc2UgJ01NJzoge1xuICAgICAgY29uc3QgemVyb0xlYWRpbmdNb250aCA9IHplcm9MZWFkaW5nKGRhdGUuZ2V0TW9udGgoKS50b1N0cmluZygpKTtcbiAgICAgIGNvbnN0IHZhbHVlID0gcmVwbGFjZU1vbnRoKHN0ci5yZXBsYWNlKG1hdGNoLCB6ZXJvTGVhZGluZ01vbnRoKSwgZGF0ZSk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGNhc2UgJ01NTSc6XG4gICAgY2FzZSAnTU1NTSc6IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcmVwbGFjZU1vbnRoKFxuICAgICAgICBzdHIucmVwbGFjZShtYXRjaCwgTU9OVEhfTkFNRVNbZGF0ZS5nZXRNb250aCgpIC0gMV0pLCBkYXRlXG4gICAgICApO1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICByZXR1cm4gc3RyO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZURheShzdHIsIGRhdGUpIHtcbiAgY29uc3QgbWF0Y2ggPSBzdHIubWF0Y2goL1tkRF0rLyk7XG4gIGlmICghbWF0Y2gpIHsgcmV0dXJuIHN0cjsgfVxuICBzd2l0Y2ggKG1hdGNoWzBdKSB7XG4gICAgY2FzZSAnRCc6IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcmVwbGFjZURheShzdHIucmVwbGFjZShtYXRjaCwgZGF0ZS5nZXREYXRlKCkpLCBkYXRlKTtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgY2FzZSAnREQnOiB7XG4gICAgICBjb25zdCB6ZXJvTGVhZGluZ0RhdGUgPSB6ZXJvTGVhZGluZyhkYXRlLmdldERhdGUoKS50b1N0cmluZygpKTtcbiAgICAgIGNvbnN0IHZhbHVlID0gcmVwbGFjZURheShzdHIucmVwbGFjZShtYXRjaCwgemVyb0xlYWRpbmdEYXRlKSwgZGF0ZSk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGNhc2UgJ2QnOlxuICAgIGNhc2UgJ2RkJzoge1xuICAgICAgY29uc3QgdmFsdWUgPSByZXBsYWNlRGF5KHN0ci5yZXBsYWNlKG1hdGNoLCBBQkJSX0RBWVNbZGF0ZS5nZXREYXkoKV0pLCBkYXRlKTtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgY2FzZSAnZGRkJzpcbiAgICBjYXNlICdkZGRkJzoge1xuICAgICAgY29uc3QgdmFsdWUgPSByZXBsYWNlRGF5KHN0ci5yZXBsYWNlKG1hdGNoLCBEQVlTX05BTUVTW2RhdGUuZ2V0RGF5KCldKSwgZGF0ZSk7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBtb2QgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgR1JFR09SSUFOX0VQT0NILCBQRVJTSUFOX0VQT0NIIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb252ZXJ0ZXIge1xuICAvLyAgTEVBUF9HUkVHT1JJQU4gIC0tICBJcyBhIGdpdmVuIHllYXIgaW4gdGhlIEdyZWdvcmlhbiBjYWxlbmRhciBhIGxlYXAgeWVhcj9cbiAgc3RhdGljIGxlYXBHcmVnb3JpYW4oeWVhcikge1xuICAgIHJldHVybiAoKHllYXIgJSA0KSA9PT0gMClcbiAgICAgICYmICghKCgoeWVhciAlIDEwMCkgPT09IDApICYmICgoeWVhciAlIDQwMCkgIT09IDApKSk7XG4gIH1cblxuICAvLyBHUkVHT1JJQU5fVE9fSkQgIC0tICBEZXRlcm1pbmUgSnVsaWFuIGRheSBudW1iZXIgZnJvbSBHcmVnb3JpYW4gY2FsZW5kYXIgZGF0ZVxuICBzdGF0aWMgZ3JlZ29yaWFuVG9KdWxpYW4oeWVhciwgbW9udGgsIGRheSkge1xuICAgIGxldCBwYWQ7XG4gICAgaWYgKG1vbnRoIDw9IDIpIHtcbiAgICAgIHBhZCA9IDA7XG4gICAgfSBlbHNlIGlmIChDb252ZXJ0ZXIubGVhcEdyZWdvcmlhbih5ZWFyKSkge1xuICAgICAgcGFkID0gLTE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhZCA9IC0yO1xuICAgIH1cblxuICAgIHJldHVybiAoR1JFR09SSUFOX0VQT0NIIC0gMSlcbiAgICAgICsgKDM2NSAqICh5ZWFyIC0gMSkpXG4gICAgICArIE1hdGguZmxvb3IoKHllYXIgLSAxKSAvIDQpXG4gICAgICArICgtTWF0aC5mbG9vcigoeWVhciAtIDEpIC8gMTAwKSlcbiAgICAgICsgTWF0aC5mbG9vcigoeWVhciAtIDEpIC8gNDAwKVxuICAgICAgKyBNYXRoLmZsb29yKCgoKDM2NyAqIG1vbnRoKSAtIDM2MikgLyAxMikgKyAocGFkICsgZGF5KSk7XG4gIH1cblxuICAvLyAgSkRfVE9fR1JFR09SSUFOICAtLSAgQ2FsY3VsYXRlIEdyZWdvcmlhbiBjYWxlbmRhciBkYXRlIGZyb20gSnVsaWFuIGRheVxuICBzdGF0aWMganVsaWFuVG9HcmVnb3JpYW4oamQpIHtcbiAgICBjb25zdCB3amQgPSBNYXRoLmZsb29yKGpkIC0gMC41KSArIDAuNTtcbiAgICBjb25zdCBkZXBvY2ggPSB3amQgLSBHUkVHT1JJQU5fRVBPQ0g7XG4gICAgY29uc3QgcXVhZHJpY2VudCA9IE1hdGguZmxvb3IoZGVwb2NoIC8gMTQ2MDk3KTtcbiAgICBjb25zdCBkcWMgPSBtb2QoZGVwb2NoLCAxNDYwOTcpO1xuICAgIGNvbnN0IGNlbnQgPSBNYXRoLmZsb29yKGRxYyAvIDM2NTI0KTtcbiAgICBjb25zdCBkY2VudCA9IG1vZChkcWMsIDM2NTI0KTtcbiAgICBjb25zdCBxdWFkID0gTWF0aC5mbG9vcihkY2VudCAvIDE0NjEpO1xuICAgIGNvbnN0IGRxdWFkID0gbW9kKGRjZW50LCAxNDYxKTtcbiAgICBjb25zdCB5aW5kZXggPSBNYXRoLmZsb29yKGRxdWFkIC8gMzY1KTtcbiAgICBsZXQgeWVhciA9IChxdWFkcmljZW50ICogNDAwKSArIChjZW50ICogMTAwKSArIChxdWFkICogNCkgKyB5aW5kZXg7XG4gICAgaWYgKCEoKGNlbnQgPT09IDQpIHx8ICh5aW5kZXggPT09IDQpKSkgeyB5ZWFyICs9IDE7IH1cbiAgICBjb25zdCB5ZWFyZGF5ID0gd2pkIC0gQ29udmVydGVyLmdyZWdvcmlhblRvSnVsaWFuKHllYXIsIDEsIDEpO1xuICAgIGxldCBsZWFwYWRqO1xuICAgIGlmICh3amQgPCBDb252ZXJ0ZXIuZ3JlZ29yaWFuVG9KdWxpYW4oeWVhciwgMywgMSkpIHtcbiAgICAgIGxlYXBhZGogPSAwO1xuICAgIH0gZWxzZSBpZiAoQ29udmVydGVyLmxlYXBHcmVnb3JpYW4oeWVhcikgPyAxIDogMikge1xuICAgICAgbGVhcGFkaiA9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxlYXBhZGogPSAyO1xuICAgIH1cbiAgICBjb25zdCBtb250aCA9IE1hdGguZmxvb3IoKCgoeWVhcmRheSArIGxlYXBhZGopICogMTIpICsgMzczKSAvIDM2Nyk7XG4gICAgY29uc3QgZGF5ID0gKHdqZCAtIENvbnZlcnRlci5ncmVnb3JpYW5Ub0p1bGlhbih5ZWFyLCBtb250aCwgMSkpICsgMTtcblxuICAgIHJldHVybiBbeWVhciwgbW9udGgsIGRheV07XG4gIH1cblxuICAvLyAgTEVBUF9QRVJTSUFOICAtLSAgSXMgYSBnaXZlbiB5ZWFyIGEgbGVhcCB5ZWFyIGluIHRoZSBQZXJzaWFuIGNhbGVuZGFyID9cbiAgc3RhdGljIGxlYXBQZXJzaWFuKHllYXIpIHtcbiAgICBpZiAoeWVhciA9PT0gMTQwMykgcmV0dXJuIHRydWU7IC8vIFdlbGwsIGFsZ29yaXRobXMgYXJlIG5vdCBwZXJmZWN0IFxcby9cbiAgICByZXR1cm4gKFxuICAgICAgKCgoKCh5ZWFyIC0gKCh5ZWFyID4gMCkgPyA0NzQgOiA0NzMpKSAlIDI4MjApICsgNDc0KSArIDM4KSAqIDY4MikgJSAyODE2XG4gICAgKSA8IDY4MjtcbiAgfVxuXG4gIC8vICBQRVJTSUFOX1RPX0pEICAtLSAgRGV0ZXJtaW5lIEp1bGlhbiBkYXkgZnJvbSBQZXJzaWFuIGRhdGVcbiAgc3RhdGljIHBlcnNpYW5Ub0p1bGlhbih5ZWFyLCBtb250aCwgZGF5KSB7XG4gICAgY29uc3QgZXBiYXNlID0geWVhciAtICgoeWVhciA+PSAwKSA/IDQ3NCA6IDQ3Myk7XG4gICAgY29uc3QgZXB5ZWFyID0gNDc0ICsgbW9kKGVwYmFzZSwgMjgyMCk7XG5cbiAgICByZXR1cm4gZGF5XG4gICAgICArICgobW9udGggPD0gNylcbiAgICAgICAgPyAoKG1vbnRoIC0gMSkgKiAzMSlcbiAgICAgICAgOiAoKChtb250aCAtIDEpICogMzApICsgNilcbiAgICAgIClcbiAgICAgICsgTWF0aC5mbG9vcigoKGVweWVhciAqIDY4MikgLSAxMTApIC8gMjgxNilcbiAgICAgICsgKChlcHllYXIgLSAxKSAqIDM2NSlcbiAgICAgICsgKE1hdGguZmxvb3IoZXBiYXNlIC8gMjgyMCkgKiAxMDI5OTgzKSArIChQRVJTSUFOX0VQT0NIIC0gMSk7XG4gIH1cblxuICAvLyAgSkRfVE9fUEVSU0lBTiAgLS0gIENhbGN1bGF0ZSBQZXJzaWFuIGRhdGUgZnJvbSBKdWxpYW4gZGF5XG4gIHN0YXRpYyBqdWxpYW5Ub1BlcnNpYW4oamQpIHtcbiAgICBjb25zdCBuamQgPSBNYXRoLmZsb29yKGpkKSArIDAuNTtcbiAgICBjb25zdCBkZXBvY2ggPSBuamQgLSBDb252ZXJ0ZXIucGVyc2lhblRvSnVsaWFuKDQ3NSwgMSwgMSk7XG4gICAgY29uc3QgY3ljbGUgPSBNYXRoLmZsb29yKGRlcG9jaCAvIDEwMjk5ODMpO1xuICAgIGNvbnN0IGN5ZWFyID0gbW9kKGRlcG9jaCwgMTAyOTk4Myk7XG4gICAgbGV0IHljeWNsZTtcbiAgICBpZiAoY3llYXIgPT09IDEwMjk5ODIpIHtcbiAgICAgIHljeWNsZSA9IDI4MjA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGF1eDEgPSBNYXRoLmZsb29yKGN5ZWFyIC8gMzY2KTtcbiAgICAgIGNvbnN0IGF1eDIgPSBtb2QoY3llYXIsIDM2Nik7XG4gICAgICB5Y3ljbGUgPSBNYXRoLmZsb29yKCgoMjEzNCAqIGF1eDEpICsgKDI4MTYgKiBhdXgyKSArIDI4MTUpIC8gMTAyODUyMilcbiAgICAgICAgKyBhdXgxICsgMTtcbiAgICB9XG4gICAgbGV0IHllYXIgPSB5Y3ljbGUgKyAoMjgyMCAqIGN5Y2xlKSArIDQ3NDtcbiAgICBpZiAoeWVhciA8PSAwKSB7XG4gICAgICB5ZWFyIC09IDE7XG4gICAgfVxuICAgIGNvbnN0IHlkYXkgPSAobmpkIC0gQ29udmVydGVyLnBlcnNpYW5Ub0p1bGlhbih5ZWFyLCAxLCAxKSkgKyAxO1xuICAgIGNvbnN0IG1vbnRoID0gKHlkYXkgPD0gMTg2KSA/IE1hdGguY2VpbCh5ZGF5IC8gMzEpIDogTWF0aC5jZWlsKCh5ZGF5IC0gNikgLyAzMCk7XG4gICAgY29uc3QgZGF5ID0gKG5qZCAtIENvbnZlcnRlci5wZXJzaWFuVG9KdWxpYW4oeWVhciwgbW9udGgsIDEpKSArIDE7XG5cbiAgICByZXR1cm4gW3llYXIsIG1vbnRoLCBkYXldO1xuICB9XG5cbiAgc3RhdGljIHBlcnNpYW5Ub0dyZWdvcmlhbih5ZWFyLCBtb250aCwgZGF5KSB7XG4gICAgY29uc3QganVsaWFuID0gQ29udmVydGVyLnBlcnNpYW5Ub0p1bGlhbih5ZWFyLCBtb250aCwgZGF5KTtcblxuICAgIHJldHVybiBDb252ZXJ0ZXIuanVsaWFuVG9HcmVnb3JpYW4oanVsaWFuKTtcbiAgfVxuXG4gIHN0YXRpYyBncmVnb3JpYW5Ub1BlcnNpYW4oeWVhciwgbW9udGgsIGRheSkge1xuICAgIGNvbnN0IGp1bGlhbiA9IENvbnZlcnRlci5ncmVnb3JpYW5Ub0p1bGlhbih5ZWFyLCBtb250aCwgZGF5KTtcblxuICAgIHJldHVybiBDb252ZXJ0ZXIuanVsaWFuVG9QZXJzaWFuKGp1bGlhbik7XG4gIH1cbn1cbiIsIi8qXG4gKiBodHRwczovL2dpdGh1Yi5jb20vYXJhc2htL0pEYXRlXG4gKiBAYXV0aG9yOiBBcmFzaCBNb3VzYXZpXG4gKi9cblxuaW1wb3J0IENvbnZlcnRlciBmcm9tICcuL2NvbnZlcnRlcic7XG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJy4vaGVscGVycyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEpEYXRlIHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3NbMF0pIHx8IGFyZ3NbMF0gaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBbdGhpcy5pbnB1dF0gPSBhcmdzO1xuICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDMpIHtcbiAgICAgIHRoaXMuaW5wdXQgPSBhcmdzO1xuICAgIH0gZWxzZSBpZiAoIWFyZ3MubGVuZ3RoKSB7XG4gICAgICB0aGlzLmlucHV0ID0gbmV3IERhdGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIGlucHV0Jyk7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5pbnB1dCkpIHtcbiAgICAgIHRoaXMuZGF0ZSA9IHRoaXMuaW5wdXQubWFwKChudW0pID0+IHBhcnNlSW50KG51bSwgMTApKTtcbiAgICAgIHRoaXMuX2QgPSB0aGlzLnRvR3JlZ29yaWFuKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlucHV0IGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgdGhpcy5fZCA9IHRoaXMuaW5wdXQ7XG4gICAgICB0aGlzLmRhdGUgPSBKRGF0ZS50b0phbGFsaSh0aGlzLmlucHV0KTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBDb3ZlcnRzIGEgR3JlZ29yaWFuIGRhdGUgdG8gSmFsYWxpIGRhdGVcbiAgICpcbiAgICogQHBhcmFtcyB7RGF0ZX0gZGF0ZVxuICAgKiBAcmV0dXJuIHtBcnJheX1cbiAgICovXG4gIHN0YXRpYyB0b0phbGFsaShkYXRlKSB7XG4gICAgY29uc3QganVsaWFuRGF0ZSA9IENvbnZlcnRlci5ncmVnb3JpYW5Ub0p1bGlhbihcbiAgICAgIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgIGRhdGUuZ2V0TW9udGgoKSArIDEsXG4gICAgICBkYXRlLmdldERhdGUoKVxuICAgICk7XG4gICAgY29uc3QgamRhdGUgPSBDb252ZXJ0ZXIuanVsaWFuVG9QZXJzaWFuKGp1bGlhbkRhdGUpO1xuXG4gICAgcmV0dXJuIGpkYXRlO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuICBzdGF0aWMgdG9famFsYWxpKGRhdGUpIHsgcmV0dXJuIEpEYXRlLnRvSmFsYWxpKGRhdGUpOyB9XG5cbiAgLypcbiAgICogY29udmVydHMgYSBKYWxhbGkgZGF0ZSB0byBHcmVnb3JpYW5cbiAgICpcbiAgICogQHBhcmFtcyB7TnVtYmVyfSB5ZWFyXG4gICAqIEBwYXJhbXMge051bWJlcn0gbW9udGhcbiAgICogQHBhcmFtcyB7TnVtYmVyfSBkYXlcbiAgICogQHJldHVybiB7RGF0ZX1cbiAgICovXG4gIHN0YXRpYyB0b0dyZWdvcmlhbih5ZWFyLCBtb250aCwgZGF5KSB7XG4gICAgY29uc3QgZ2RhdGUgPSBDb252ZXJ0ZXIuanVsaWFuVG9HcmVnb3JpYW4oXG4gICAgICBDb252ZXJ0ZXIucGVyc2lhblRvSnVsaWFuKHllYXIsIG1vbnRoLCBkYXkpXG4gICAgKTtcblxuICAgIHJldHVybiBuZXcgRGF0ZSgrZ2RhdGVbMF0sICtnZGF0ZVsxXSAtIDEsICtnZGF0ZVsyXSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlXG4gIHN0YXRpYyB0b19ncmVnb3JpYW4oeWVhciwgbW9udGgsIGRheSkgeyByZXR1cm4gSkRhdGUudG9HcmVnb3JpYW4oeWVhciwgbW9udGgsIGRheSk7IH1cblxuICAvKlxuICAgKiBDaGVja3MgaWYgYSBnaXZlbiB5ZWFyIGlzIGEgbGVhcCB5ZWFyIG9yIG5vdFxuICAgKlxuICAgKiBAcGFyYW1zIHtOdW1iZXJ9IHllYXJcbiAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICovXG4gIHN0YXRpYyBpc0xlYXBZZWFyKHllYXIpIHtcbiAgICByZXR1cm4gQ29udmVydGVyLmxlYXBQZXJzaWFuKHllYXIpO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJucyBtb250aCBsZW5ndGguXG4gICAqXG4gICAqIEBwYXJhbXMge051bWJlcn0geWVhclxuICAgKiBAcGFyYW1zIHtOdW1iZXJ9IG1vbnRoIHplcm8gYmFzZWRcbiAgICogQHJldHVybiB7TnVtYmVyfVxuICAgKi9cbiAgc3RhdGljIGRheXNJbk1vbnRoKHllYXIsIG1vbnRoKSB7XG4gICAgbGV0IGNhbGNlZFllYXIgPSB5ZWFyIC0gTWF0aC5mbG9vcihtb250aCAvIDEyKTtcbiAgICBsZXQgY2FsY2VkTW9udGggPSBtb250aCAtIChNYXRoLmZsb29yKG1vbnRoIC8gMTIpICogMTIpO1xuXG4gICAgaWYgKGNhbGNlZE1vbnRoIDwgMCkge1xuICAgICAgY2FsY2VkTW9udGggKz0gMTI7XG4gICAgICBjYWxjZWRZZWFyIC09IDE7XG4gICAgfSBlbHNlIGlmIChjYWxjZWRNb250aCA9PT0gMCkge1xuICAgICAgY2FsY2VkTW9udGggPSAxMjtcbiAgICB9XG5cbiAgICBpZiAoY2FsY2VkTW9udGggPCA2KSB7XG4gICAgICByZXR1cm4gMzE7XG4gICAgfSBpZiAoY2FsY2VkTW9udGggPCAxMSkge1xuICAgICAgcmV0dXJuIDMwO1xuICAgIH0gaWYgKEpEYXRlLmlzTGVhcFllYXIoY2FsY2VkWWVhcikpIHtcbiAgICAgIHJldHVybiAzMDtcbiAgICB9XG4gICAgcmV0dXJuIDI5O1xuICB9XG5cbiAgLypcbiAgICogQ29udmVydHMgSkRhdGUgZGF0ZSB0byBHcmVnb3JpYW5cbiAgICovXG4gIHRvR3JlZ29yaWFuKCkge1xuICAgIHJldHVybiBKRGF0ZS50b0dyZWdvcmlhbih0aGlzLmRhdGVbMF0sIHRoaXMuZGF0ZVsxXSwgdGhpcy5kYXRlWzJdKTtcbiAgfVxuXG4gIC8qXG4gICAqIFNob3dzIEphbGFsaSdzIGZ1bGwgeWVhciwgZXg6IDEzOTNcbiAgICpcbiAgICogQHJldHVybiB7SW50ZWdlcn1cbiAgICovXG4gIGdldEZ1bGxZZWFyKCkge1xuICAgIHJldHVybiB0aGlzLmRhdGVbMF07XG4gIH1cblxuICAvKlxuICAgKiBTZXRzIHRoZSBKYWxhbGkgZnVsbCB5ZWFyXG4gICAqXG4gICAqIEBwYXJhbXMge051bWJlcn0geWVhclxuICAgKiBAcmV0dXJuIHtKRGF0ZX1cbiAgICovXG4gIHNldEZ1bGxZZWFyKHllYXIpIHtcbiAgICB0aGlzLmRhdGVbMF0gPSBwYXJzZUludCh5ZWFyLCAxMCk7XG4gICAgdGhpcy5pbnB1dCA9IHRoaXMudG9HcmVnb3JpYW4oKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qXG4gICAqIFNob3dzIEphbGFsaSBtb250aCBudW1iZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge051bWJlcn0gSmFsYWxpIG1vbnRoIG51bWJlclxuICAgKi9cbiAgZ2V0TW9udGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0ZVsxXTtcbiAgfVxuXG4gIC8qXG4gICAqIFNldHMgdGhlIEphbGFsaSBtb250aCBudW1iZXIuIEFuIGludGVnZXIgYmV0d2VlbiAwIGFuZCAxMVxuICAgKlxuICAgKiBAcGFyYW1zIHtOdW1iZXJ9IG1vbnRoXG4gICAqIEByZXR1cm5zIHtKRGF0ZX1cbiAgICovXG4gIHNldE1vbnRoKG1vbnRoKSB7XG4gICAgY29uc3QgZml4ZWQgPSBoZWxwZXJzLmZpeE1vbnRoKHRoaXMuZ2V0RnVsbFllYXIoKSwgcGFyc2VJbnQobW9udGgsIDEwKSk7XG4gICAgW3RoaXMuZGF0ZVswXSwgdGhpcy5kYXRlWzFdXSA9IGZpeGVkO1xuICAgIHRoaXMuaW5wdXQgPSB0aGlzLnRvR3JlZ29yaWFuKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qXG4gICAqIFNob3dzIEphbGFsaSBkYXkgbnVtYmVyLiBBIG51bWJlciBiZXR3ZWVuIDAgdG8gMzFcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSBKYWxhbGkgZGF5IG51bWJlclxuICAgKi9cbiAgZ2V0RGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRlWzJdO1xuICB9XG5cbiAgLypcbiAgICogU2V0cyBKYWxhbGkgZGF5IG51bWJlci4gQSBudW1iZXIgYmV0d2VlbiAwIHRvIDMxXG4gICAqXG4gICAqIEBwYXJhbXMge051bWJlcn0gZGF0ZVxuICAgKiBAcmV0dXJuIHtKRGF0ZX1cbiAgICovXG4gIHNldERhdGUoZGF0ZSkge1xuICAgIHRoaXMuZGF0ZVsyXSA9IHBhcnNlSW50KGRhdGUsIDEwKTtcbiAgICB0aGlzLmlucHV0ID0gdGhpcy50b0dyZWdvcmlhbigpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKlxuICAgKiBSZXR1cm5zIHRoZSBkYXkgb2YgdGhlIHdlZWsgZm9yIHRoZSBzcGVjaWZpZWQgZGF0ZS4gQSBudW1iZXIgYmV0d2VlbiAwIHRvIDZcbiAgICpcbiAgICogQHJldHVybnMge051bWJlcn1cbiAgICovXG4gIGdldERheSgpIHtcbiAgICByZXR1cm4gdGhpcy5fZC5nZXREYXkoKTtcbiAgfVxuXG4gIC8qXG4gICAqIFJldHVybnMgYSBmb3JtYXRlZCBvdXRwdXQgb2YgY3VycmVudCBkYXRlXG4gICAqXG4gICAqIEBwYXJhbXMge1N0cmluZ30gZm9ybWF0XG4gICAqIEByZXR1cm4ge1N0cmluZ31cbiAgICovXG4gIGZvcm1hdChmb3JtYXQpIHtcbiAgICBsZXQgcmVzdWx0ID0gaGVscGVycy5yZXBsYWNlWWVhcihmb3JtYXQsIHRoaXMpO1xuICAgIHJlc3VsdCA9IGhlbHBlcnMucmVwbGFjZU1vbnRoKHJlc3VsdCwgdGhpcyk7XG4gICAgcmVzdWx0ID0gaGVscGVycy5yZXBsYWNlRGF5KHJlc3VsdCwgdGhpcyk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9